## I2S Standard
https://web.archive.org/web/20070102004400/http://www.nxp.com/acrobat_download/various/I2SBUS.pdf

I2S (Inter-IC Sound) a serial link designed especially for transmitting digital audio data.

The I²S bus separates clock and serial data signals, resulting in simpler receivers than those required for asynchronous communications systems that need to recover the clock from the data stream.
This standard was introduced in 1986 by Philips Semiconductor (https://web.archive.org/web/20070102004400/http://www.nxp.com/acrobat_download/various/I2SBUS.pdf) and was first revised June 5, 1996. The standard was last revised on February 17, 2022 and updated terms master and slave to controller and target.(https://www.nxp.com/docs/en/user-manual/UM11732.pdf)

### Configuration
![image](https://github.com/alex-florescu/CS351/assets/97969710/47f02d17-1b90-483f-b219-c7a122778682)
As shown in Figure 1, the bus has three lines (each of them of size 1-bit):
- Continuous Serial Clock (SCK);
- Word Select (WS);
- Serial Data (SD);
Where SCK and WS signlas are generated by the controller device.

#### 1. Serial Data
- transmitted in two’s complement with the MSB first. The MSB is transmitted first because the transmitter and receiver may have different word lengths.
- the MSB has a fixed position, whereas the position of the LSB depends on the word length
  - When the system word length is greater than the **transmitter** word length, the word is truncated
  - If the **receiver** is sent more bits than its word length, the bits after the LSB are ignored.
 
#### 2. Word select
The word select line indicates the channel being transmitted:
- WS = 0; channel 1 (left);
- WS = 1; channel 2 (right).
The official I2S specification explains that "WS may change either on a trailing or leading edge of the serial clock, but it doesn’t need to be symmetrical.
An important feature of the WS signal si that it changes **one clock cycle after the MSB is transmitted**, which allowes a clock cycle for other necessary calculations, such as:
- allowing target transmitter to derive synchronous timing of the serial data that will be set up for transmission
- enabling the receiver to store the previous word and clear the input for the next word
(https://www.nxp.com/docs/en/user-manual/UM11732.pdf)


## I2S signals on Zybo Z7 - Copied directly from the reference manual!!!!!!
| Signal | Description |
| -- | -- |
MCLK | master/slave configuraion (decides direction of BCLK, PBLRC and RECLRC)
BCLK | clock on which data is sent bit by bit
PBLRC/RECLRC | word select (Left/Right) signals for Output and Input ports respectively
PBDAT/RECDAT | 1-bit data bus for Output and Input channels respectively
MUTE | Active low mute output. Set to 1 to enable audio output\
SCL | I2C clock
SDA | I2C data

  * the two I2C signals are used (By Zynq) to configure the audio codec (example: the DMA Audio Demo selects input from either Line In or Mic In, but the Audio Codec has only got 1 set of RECDAT pins in the Constraints file)


![image](https://github.com/alex-florescu/CS351/assets/97969710/fec3a1f6-154f-4554-b0b2-382059f34d48)
The audio codec needs to be clocked from the Zynq on the MCLK pin. This master clock will be used by the audio codec to establish the audio sampling frequency. This clock is required to be an integer multiple of the desired sampling rate. The default settings require a master clock of 12.288 Mhz, resulting in a 48 kHz sampling rate. For other frequencies and their respective configuration parameters, consult the SSM2603 datasheet.

The codec has two modes: master and slave, with the slave being default. In this mode, the direction of the signals is specified in Table 12.2. When configured as master, the direction of BCLK, PBLRC and RECLRC is inverted. In this mode, the codec generates the proper frequencies for these clocks. No matter where the clocks are generated, PBDAT needs to be driven out and RECDAT sampled in sync with them. The master clock is always driven out of the Zynq. The timing diagram of an I²S stream can be seen on Figure 12.1. Note the one-cycle delay of the data stream with respect to the left/right clock changing state. Audio samples are transmitted MSB first, noted as 1 in the diagram.
The digital mute signal (MUTE) is active-low, with a pull-down resistor. This means that when not used in the design, it will stay low and the analog outputs of the codec will stay muted. To enable the analog outputs, drive this signal high.

To use the audio codec in a design with non-default settings, it needs to be configured over I2C. The audio path needs to be established by configuring the (de)multiplexers and amplifiers in the codec. Some digital processing can also be done in the codec. Configuration is read out and written by accessing the register map via I2C transfers. The register map is described in the SSM2603 datasheet.
![image](https://github.com/alex-florescu/CS351/assets/97969710/66f8a472-c360-4241-aa16-a4fdb96aebe8)

A demo project that uses the Zybo Z7 audio codec in a bare-metal application can be found on the Zybo Z7 Resource Center. The audio codec is also supported in Petalinux generated embedded Linux systems, and will appear as a standard ALSA audio device. (https://digilent.com/reference/programmable-logic/zybo-z7/reference-manual)

## Configuring the I2S Audio Codec
* https://c64onfpga.blogspot.com/2019/02/creating-sound-on-zybo-board.html
* https://docs.xilinx.com/r/en-US/ug1085-zynq-ultrascale-trm/I2C-Controller-Programming-Steps



